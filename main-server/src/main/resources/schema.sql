-- DROP TABLE IF EXISTS REQUESTS;
-- DROP TABLE IF EXISTS EVENT_RATING;
-- DROP TABLE IF EXISTS EVENTS;
-- DROP TABLE IF EXISTS USERS;
-- DROP TABLE IF EXISTS CATEGORIES;
-- DROP TABLE IF EXISTS LOCATIONS;
-- DROP TABLE IF EXISTS LIST_EVENTS;
-- DROP TABLE IF EXISTS COMPILATIONS;

CREATE TABLE IF NOT EXISTS USERS
(
    ID    BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME  CHARACTER VARYING                       NOT NULL,
    EMAIL CHARACTER VARYING                       NOT NULL,
    CONSTRAINT UN_EMAIL UNIQUE (EMAIL),
    CONSTRAINT USERS_PK
        PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS CATEGORIES
(
    ID   BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME CHARACTER VARYING                       NOT NULL,
    CONSTRAINT UN_NAME UNIQUE (NAME),
    CONSTRAINT CATEGORIES_PK
        PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS LOCATIONS
(
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY,
    LAT FLOAT NOT NULL,
    LON FLOAT NOT NULL,
    CONSTRAINT LOCATIONS_PK
        PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS EVENTS
(
    ID                 BIGINT GENERATED BY DEFAULT AS IDENTITY,
    ANNOTATION         VARCHAR                     NOT NULL,
    CREATED_ON         TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    DESCRIPTION        VARCHAR                     NOT NULL,
    EVENT_DATE         TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    PAID               BOOLEAN,
    PARTICIPANT_LIMIT  INT,
    REQUEST_MODERATION BOOLEAN,
    TITLE              VARCHAR,
    CATEGORY           BIGINT                      NOT NULL,
    INITIATOR          BIGINT                      NOT NULL,
    LOCATION           BIGINT                      NOT NULL,
    PUBLISHED_ON       TIMESTAMP WITHOUT TIME ZONE,
    STATE              VARCHAR                     NOT NULL,

    CONSTRAINT EVENTS_PK
        PRIMARY KEY (ID),
    CONSTRAINT LOCATION_FK
        FOREIGN KEY (LOCATION) REFERENCES LOCATIONS,
    CONSTRAINT CATEGORY_FK
        FOREIGN KEY (CATEGORY) REFERENCES CATEGORIES,
    CONSTRAINT INITIATOR_FK
        FOREIGN KEY (INITIATOR) REFERENCES USERS
);

CREATE TABLE IF NOT EXISTS REQUESTS
(
    ID        BIGINT GENERATED BY DEFAULT AS IDENTITY,
    EVENT     BIGINT    NOT NULL,
    REQUESTER BIGINT    NOT NULL,
    CREATED   TIMESTAMP NOT NULL,
    STATUS    VARCHAR   NOT NULL,
    CONSTRAINT REQUESTS_PK
        PRIMARY KEY (ID),
    CONSTRAINT REQUESTER_FK
        FOREIGN KEY (REQUESTER) REFERENCES USERS,
    CONSTRAINT EVENT_FK
        FOREIGN KEY (EVENT) REFERENCES EVENTS
);
CREATE TABLE IF NOT EXISTS COMPILATIONS
(
    ID     BIGINT GENERATED BY DEFAULT AS IDENTITY,
    PINNED BOOLEAN,
    TITLE  VARCHAR,
    CONSTRAINT COMPILATIONS_PK
        PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS LIST_EVENTS
(
    ID     BIGINT NOT NULL,
    EVENTS BIGINT,
    CONSTRAINT LIST_EVENTS_FK
        FOREIGN KEY (ID) REFERENCES COMPILATIONS
);

CREATE TABLE IF NOT EXISTS EVENT_RATING
(
    ID       BIGINT GENERATED BY DEFAULT AS IDENTITY,
    USER_ID  BIGINT  NOT NULL,
    EVENT_ID BIGINT  NOT NULL,
    STATUS   BOOLEAN NOT NULL,
    CONSTRAINT EVENT_RATING_PK
        PRIMARY KEY (ID),
    CONSTRAINT USER_FK
        FOREIGN KEY (USER_ID) REFERENCES USERS,
    CONSTRAINT EVENT_FK
        FOREIGN KEY (EVENT_ID) REFERENCES EVENTS
);